# Work Plan: 4.8 Board Actions Menu Positioning Fix

## Context

### Original Request
Ensure BoardActionsMenu works correctly in collapsed sidebar icon-only mode.

### Interview Summary
**Key Discussions**:
- This is a test-first task: verify current behavior before making changes
- The `group/board` class scopes hover states to individual menu items
- Potential issue: positioning in collapsed/icon-only sidebar mode

**Research Findings**:
- `app-sidebar.tsx:L151`: `BoardActionsMenu` is sibling to `SidebarMenuButton`
- Uses `group/board` class for hover scoping
- shadcn/ui has `SidebarMenuAction` slot pattern that might be preferred
- Current implementation may work fine - needs testing first

### Spec Reference
- `ralph-wiggum/specs/4.8-board-actions-menu-positioning.md`

---

## Work Objectives

### Core Objective
Verify BoardActionsMenu positioning in collapsed sidebar and fix if issues exist.

### Concrete Deliverables
- UX testing checklist completed with documented findings
- Fix applied only if issues discovered

### Definition of Done
- [ ] UX testing checklist completed and documented
- [ ] Actions menu visible and functional in collapsed mode (or fix applied)
- [ ] Dropdown positions correctly in all sidebar states
- [ ] `pnpm run build` passes
- [ ] `pnpm run lint` passes

### Must Have
- Complete UX testing before any code changes
- Documentation of findings regardless of outcome

### Must NOT Have (Guardrails)
- Code changes without verified issues
- Breaking existing hover behavior
- Unnecessary refactoring if current implementation works

---

## Verification Strategy

### Test Decision
- **Approach**: Manual UX testing with browser automation
- **QA approach**: Playwright-based verification with screenshots

---

## Task Flow

```
Task 1 (UX Testing) → Task 2 (Fix if needed)
```

## Parallelization

| Task | Depends On | Reason |
|------|------------|--------|
| 1 | None | Testing first |
| 2 | 1 | Only if issues found |

---

## TODOs

- [ ] 1. Complete UX Testing Checklist

  **What to do**:
  - Open OpenKanban in browser at `http://localhost:37291`
  - Navigate to a project with at least one board
  - Run through the complete UX testing checklist
  - Document findings in this file or create issue doc

  **Must NOT do**:
  - Don't make code changes during testing
  - Don't skip any test items

  **Parallelizable**: NO (must complete first)

  **References**:

  **Pattern References**:
  - `OpenKanban/src/components/layout/app-sidebar.tsx:L147-170` - Current BoardActionsMenu integration
  - `OpenKanban/src/features/boards/components/board-actions-menu.tsx` - Menu component implementation

  **Test Procedure**:

  **A. Collapsed Sidebar Test**:
  ```
  1. Click sidebar collapse toggle (rail button)
  2. Verify sidebar collapses to icon-only mode
  3. Verify board icons (kanban icon) are visible
  4. Hover over board item
  5. Verify tooltip shows board name
  ```

  **B. Actions Menu Test** (in collapsed mode):
  ```
  1. Hover over a board item
  2. Check if three-dot menu (or actions icon) appears
  3. Click actions menu
  4. Verify dropdown opens
  5. Check dropdown direction (should open to the right, not overlap sidebar)
  6. Verify menu items (Rename, Delete) are clickable
  7. Click Rename - verify dialog opens
  8. Click Delete - verify confirmation dialog opens
  ```

  **C. Positioning Test**:
  ```
  1. With sidebar collapsed, open actions menu
  2. Verify dropdown doesn't overflow viewport
  3. Verify dropdown isn't cut off by sidebar edge
  4. Resize window to small width
  5. Verify dropdown repositions appropriately
  ```

  **D. Keyboard Test**:
  ```
  1. Tab to board item
  2. Tab to actions menu (should be focusable)
  3. Press Enter - verify dropdown opens
  4. Arrow down - verify navigation works
  5. Press Escape - verify dropdown closes
  ```

  **E. Expanded Sidebar Test** (control):
  ```
  1. Expand sidebar
  2. Repeat tests B, C, D
  3. Verify behavior is consistent
  ```

  **Acceptance Criteria**:

  **Using Playwright browser automation**:
  - [ ] Navigate to: `http://localhost:37291/project/[projectId]`
  - [ ] Action: Click sidebar collapse toggle
  - [ ] Verify: Sidebar collapses to icon-only mode
  - [ ] Screenshot: Save to `.sisyphus/evidence/4.8-collapsed-sidebar.png`
  - [ ] Action: Hover over board item in sidebar
  - [ ] Verify: Actions menu appears (three-dot icon)
  - [ ] Action: Click actions menu
  - [ ] Verify: Dropdown opens, positioned correctly (not cut off)
  - [ ] Screenshot: Save to `.sisyphus/evidence/4.8-actions-dropdown.png`
  - [ ] Action: Click "Rename" option
  - [ ] Verify: Rename dialog opens

  **Document Results**:
  - [ ] Create file: `.sisyphus/evidence/4.8-ux-test-results.md`
  - [ ] Record PASS/FAIL for each test item
  - [ ] If FAIL: Document specific issue with screenshot

  **Commit**: NO (testing only)

---

- [ ] 2. Apply Fix (CONDITIONAL - only if Task 1 finds issues)

  **What to do**:
  - If UX testing reveals positioning issues:
    1. Refactor to use `SidebarMenuAction` slot pattern
    2. Update `BoardActionsMenu` to work with `asChild` pattern
    3. Remove `group/board` class if no longer needed

  **Must NOT do**:
  - Don't execute if all tests pass
  - Don't break existing functionality
  - Don't change styling unless necessary for fix

  **Parallelizable**: NO (depends on 1)

  **References**:

  **Pattern References**:
  - `OpenKanban/src/components/layout/app-sidebar.tsx:L151` - Current implementation
  - shadcn/ui sidebar docs - `SidebarMenuAction` pattern

  **Current Code** (app-sidebar.tsx ~L151):
  ```typescript
  <SidebarMenuItem key={board.id} className='group/board'>
    <SidebarMenuButton asChild tooltip={board.name} isActive={isBoardActive}>
      <Link href={...}>
        <IconLayoutKanban className='h-4 w-4' />
        <span>{board.name}</span>
      </Link>
    </SidebarMenuButton>
    <DialogErrorBoundary>
      <BoardActionsMenu
        boardId={board.id}
        boardName={board.name}
        projectId={projectId}
      />
    </DialogErrorBoundary>
  </SidebarMenuItem>
  ```

  **Proposed Fix** (if needed):
  ```typescript
  <SidebarMenuItem key={board.id}>
    <SidebarMenuButton asChild tooltip={board.name} isActive={isBoardActive}>
      <Link href={...}>
        <IconLayoutKanban className='h-4 w-4' />
        <span>{board.name}</span>
      </Link>
    </SidebarMenuButton>
    <SidebarMenuAction asChild>
      <DialogErrorBoundary>
        <BoardActionsMenu
          boardId={board.id}
          boardName={board.name}
          projectId={projectId}
        />
      </DialogErrorBoundary>
    </SidebarMenuAction>
  </SidebarMenuItem>
  ```

  **If SidebarMenuAction not available**:
  - Check if it exists in `@/components/ui/sidebar`
  - If not, add positioning CSS to `BoardActionsMenu` for collapsed mode

  **Acceptance Criteria**:

  **If fix applied**:
  - [ ] Re-run complete UX testing checklist
  - [ ] All tests PASS
  - [ ] `pnpm run build` → 0 errors
  - [ ] `pnpm run lint` → 0 errors

  **If no fix needed** (all tests passed):
  - [ ] Document in `.sisyphus/evidence/4.8-ux-test-results.md`: "PASS - No changes needed"
  - [ ] Close task as "verified working"

  **Commit**: YES (only if changes made)
  - Message: `fix(sidebar): correct BoardActionsMenu positioning in collapsed mode`
  - Files: `src/components/layout/app-sidebar.tsx`

---

## Commit Strategy

| After Task | Message | Files | Verification |
|------------|---------|-------|--------------|
| 1 | No commit (testing) | - | UX checklist |
| 2 | `fix(sidebar): correct BoardActionsMenu positioning` | app-sidebar.tsx | pnpm build + UX retest |

---

## Success Criteria

### Verification Commands
```bash
pnpm run build  # Expected: 0 errors
pnpm run lint   # Expected: 0 errors
```

### Final Checklist
- [ ] UX testing checklist completed
- [ ] Results documented in `.sisyphus/evidence/`
- [ ] Actions menu works in collapsed mode
- [ ] Fix applied only if issues found
- [ ] Build and lint pass
