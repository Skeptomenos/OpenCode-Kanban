# Spec: Phase 5.12 - Verify New Board Functionality

> **Goal:** Verify the "New Board" button in the sidebar creates boards correctly.
> **Context:** "+ New Board" appears under expanded projects but functionality wasn't tested.
> **Priority:** P2 - Medium (feature verification)

## Background

The sidebar displays a "+ New Board" option under each expanded project. This should:
1. Open a dialog to enter board name
2. Create a new board linked to the project
3. Add the board to the sidebar list
4. Navigate to the new board

## 1. Locate New Board Trigger
**File:** `src/components/layout/app-sidebar.tsx`

**Expected Structure:**
```tsx
// Under each project's expanded section
<Collapsible open={isExpanded}>
  <CollapsibleContent>
    {/* Existing boards */}
    {boards.map(board => <BoardItem key={board.id} board={board} />)}
    
    {/* New Board trigger */}
    <CreateBoardDialog projectId={project.id}>
      <button className="...">
        <IconPlus /> New Board
      </button>
    </CreateBoardDialog>
  </CollapsibleContent>
</Collapsible>
```

**Alternative Implementation:**
The trigger might be a menu item in the project's action menu.

## 2. Verify CreateBoardDialog Component
**File:** `src/features/boards/components/create-board-dialog.tsx`

**Expected Props:**
```typescript
interface CreateBoardDialogProps {
  projectId: string;  // Parent project ID
  children: React.ReactNode;  // Trigger element
}
```

**Expected Behavior:**
1. Clicking trigger opens dialog
2. Dialog has input for board title
3. Submit calls mutation to create board
4. Dialog closes on success
5. Sidebar updates with new board

## 3. Verify Dialog UI
**File:** `src/features/boards/components/create-board-dialog.tsx`

**Expected Structure:**
```tsx
<Dialog>
  <DialogTrigger asChild>{children}</DialogTrigger>
  <DialogContent>
    <DialogHeader>
      <DialogTitle>Create Board</DialogTitle>
    </DialogHeader>
    
    <form onSubmit={handleSubmit}>
      <Input
        placeholder="Board title"
        value={title}
        onChange={(e) => setTitle(e.target.value)}
      />
      <Button type="submit">Create</Button>
    </form>
  </DialogContent>
</Dialog>
```

## 4. Verify Create Board Mutation
**File:** `src/features/boards/hooks/use-board-mutations.ts`

**Expected:**
```typescript
export function useCreateBoardMutation() {
  const queryClient = useQueryClient();
  
  return useMutation({
    mutationFn: async (data: { title: string; parentId: string }) => {
      return createBoard({
        title: data.title,
        filters: { types: ['task'], parentId: data.parentId },
        columnConfig: [
          { id: 'backlog', title: 'Backlog', statusMappings: ['backlog'] },
        ],
      });
    },
    onSuccess: (newBoard) => {
      // Invalidate boards query to show new board in sidebar
      queryClient.invalidateQueries({ queryKey: ['boards'] });
    },
  });
}
```

## 5. Verify API Endpoint
**File:** `src/app/api/boards/route.ts`

**Expected POST handler:**
```typescript
export async function POST(request: Request) {
  const body = await request.json();
  
  const validated = CreateBoardSchema.parse(body);
  
  const board = await boardService.create({
    id: generateId(),
    title: validated.title,
    filters: validated.filters,
    columnConfig: validated.columnConfig,
    createdAt: Date.now(),
    updatedAt: Date.now(),
  });
  
  return NextResponse.json({ success: true, data: board });
}
```

**Check Zod Schema:**
```typescript
const CreateBoardSchema = z.object({
  title: z.string().min(1, 'Board title required'),
  filters: z.object({
    types: z.array(z.string()).optional(),
    parentId: z.string().optional(),
  }).optional(),
  columnConfig: z.array(ColumnConfigSchema).optional(),
});
```

## 6. Verify Sidebar Updates
**File:** `src/components/layout/app-sidebar.tsx`

**Check:** Boards are fetched with React Query:
```typescript
const { data: boards } = useBoards(projectId);
```

**Check:** Query key matches what mutation invalidates:
```typescript
// In useBoards
queryKey: ['boards', { parentId: projectId }]

// In mutation onSuccess
queryClient.invalidateQueries({ queryKey: ['boards'] })
```

**Potential Issue:** If query keys don't match, sidebar won't update.

## 7. Verify Navigation to New Board
**File:** `src/features/boards/components/create-board-dialog.tsx`

**Expected:** After creation, navigate to the new board:
```typescript
import { useRouter } from 'next/navigation';

const router = useRouter();

const mutation = useMutation({
  onSuccess: (newBoard) => {
    router.push(`/project/${projectId}/board/${newBoard.id}`);
    setOpen(false);  // Close dialog
  },
});
```

## 8. Default Column Configuration
**File:** `src/features/boards/hooks/use-board-mutations.ts`

**Check:** New boards should have default columns:
```typescript
const defaultColumnConfig = [
  { id: 'backlog', title: 'Backlog', statusMappings: ['backlog'] },
  { id: 'in-progress', title: 'In Progress', statusMappings: ['in-progress'] },
  { id: 'done', title: 'Done', statusMappings: ['done'] },
];
```

Or use constants:
```typescript
import { DEFAULT_COLUMN_CONFIG } from '@/lib/constants/board-defaults';
```

## Verification Checklist
- [ ] Expand a project in sidebar
- [ ] Click "+ New Board"
- [ ] Dialog opens with title input
- [ ] Enter "Test Board" and submit
- [ ] Board appears under project in sidebar
- [ ] Navigated to new board page
- [ ] Board has default columns (Backlog, etc.)
- [ ] Refresh page â†’ new board persists

## Files to Verify
| File | Check |
|------|-------|
| `src/components/layout/app-sidebar.tsx` | "+ New Board" trigger exists |
| `src/features/boards/components/create-board-dialog.tsx` | Dialog implementation |
| `src/features/boards/hooks/use-board-mutations.ts` | Create mutation |
| `src/app/api/boards/route.ts` | POST endpoint |
| `src/services/board-service.ts` | Service create method |

## Related Specs
- `5.1-sidebar-overhaul.md` - Sidebar structure
- Phase 4 board management specs
