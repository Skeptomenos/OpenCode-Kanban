# Spec: Phase 5.1 - Sidebar Overhaul

> **Goal:** Refactor the sidebar to merge boards into the project tree, improve layout density, and fix UI overlays.
> **Context:** The sidebar currently separates Projects and Project Boards. It also overlays content on desktop instead of pushing it.

## 1. Hierarchy Refactor (Critical)
**File:** `src/components/layout/app-sidebar.tsx`
- **Requirement:** Remove the separate "Project Boards" group.
- **Action:**
  - Inside the "Projects" `SidebarGroup`, update the rendering logic.
  - For each `SidebarMenuItem` (Project), check if it's the active project.
  - If active (or matches `projectId`), fetch boards using `useBoards(project.id)`.
  - Render boards as `SidebarMenuSub` items under the project.
  - Use `Collapsible` trigger for the project item to show/hide boards.

## 2. Layout & Density (Visual)
**File:** `src/components/ui/infobar.tsx`, `src/app/project/[projectId]/layout.tsx`
- **Requirement:** "Push Mode" on desktop.
- **Action:**
  - In `infobar.tsx`: Remove `absolute inset-y-0` for `md:` breakpoint. Use `relative h-full border-l`.
  - In `layout.tsx`: Ensure the main content container uses `flex-row` so the sidebar sits next to the content.
- **Density:** In `app-sidebar.tsx`, ensure `SidebarMenuItem` has consistent vertical spacing (e.g., `gap-2` or `py-2`) in both collapsed and expanded states.

## 3. Project Actions & Optimistic Updates
**File:** `src/features/projects/components/project-actions-menu.tsx` (Create New)
- **Requirement:** Add `...` menu to Projects in the sidebar.
- **Action:**
  - Create new component by copying `src/features/boards/components/board-actions-menu.tsx`.
  - Adapt actions: "Rename Project", "Delete Project".
  - Use `useProjectMutations`.
  - Integrate into `app-sidebar.tsx`.

**File:** `src/features/projects/hooks/use-project-mutations.ts` (Create/Update)
- **Requirement:** Implement optimistic updates for instant feedback.
- **Logic:**
  - `onMutate`: Cancel queries. Snapshot previous projects.
  - `setQueriesData`: Manually update `['projects']` cache (rename or filter out deleted project).
  - `onError`: Rollback.
  - `onSettled`: Invalidate.

**File:** `src/features/boards/hooks/use-board-mutations.ts`
- **Action:** Add optimistic updates for Board Rename/Delete (mirroring project logic).

## 4. Verification
- [ ] Clicking Project chevron expands boards list.
- [ ] Clicking a board navigates correctly.
- [ ] Opening Task Details pushes the board content (doesn't cover).
- [ ] Project `...` menu allows renaming/deleting.
- [ ] UI updates *instantly* when renaming/deleting (check via Network throttling).
