# Spec: Phase 4.5 - Status Constants Standardization

> **Goal**: Eliminate inconsistent status mapping values across the codebase.
> **Context**: Production code uses `in-progress` (hyphen), tests use `in_progress` (underscore). This can cause issues matching statuses to columns.
> **Issue Reference**: `docs/phase4-board-management-issues.md#L100-135`

## 1. Problem Statement

Status values are inconsistent across 9 files (25 occurrences found in audit):
- **Production**: `'in-progress'` (hyphen)
- **Tests**: `'in_progress'` (underscore)

If issues use `in_progress` as their status, they won't appear in the "In Progress" column mapped to `in-progress`.

## 2. Requirements

### 2.1 Create Canonical Status Constants
- **Directory**: Create `OpenKanban/src/lib/constants/` if it doesn't exist.
- **File**: `OpenKanban/src/lib/constants/statuses.ts` (Create new file)
- **Content**:
    ```typescript
    export const ISSUE_STATUSES = {
      BACKLOG: 'backlog',
      IN_PROGRESS: 'in-progress',
      DONE: 'done',
    } as const;

    export type IssueStatus = (typeof ISSUE_STATUSES)[keyof typeof ISSUE_STATUSES];
    ```

### 2.2 Update All References (Comprehensive List)
Replace string literals with `ISSUE_STATUSES.IN_PROGRESS` (and other constants) in ALL of the following files:

**Production Code:**
- `OpenKanban/src/features/boards/components/create-board-dialog.tsx`
- `OpenKanban/src/app/project/[projectId]/board/page.tsx`
- `OpenKanban/src/app/project/[projectId]/page.tsx`

**Test Code:**
- `OpenKanban/src/lib/db/__tests__/repository-boards.test.ts`
- `OpenKanban/src/services/__tests__/issue-service.test.ts`
- `OpenKanban/src/services/__tests__/board-service.test.ts`
- `OpenKanban/src/lib/db/__tests__/repository.test.ts`
- `OpenKanban/src/contract/pm/__tests__/schemas.test.ts`
- `OpenKanban/src/app/api/boards/__tests__/route.test.ts`

**Note**: You will need to add import statements to these files:
```typescript
import { ISSUE_STATUSES } from '@/lib/constants/statuses';
```

### 2.3 Database Audit & Migration Strategy
- **Query**: Run `SELECT DISTINCT status FROM issues`
- **Decision Matrix**:

| DB Contains      | Action                                                                                  |
| ---------------- | --------------------------------------------------------------------------------------- |
| Only `in-progress` | No migration needed                                                                     |
| Only `in_progress` | Create migration: `UPDATE issues SET status = 'in-progress' WHERE status = 'in_progress'` |
| Both             | Create migration to unify to `in-progress`                                              |
| Neither          | No issues exist - proceed with constants                                                |

- **Migration File (if needed)**: Create `OpenKanban/src/lib/db/migrations/0003_status_standardization.sql`

### 2.4 Add Validation Test
- **File**: `OpenKanban/src/lib/constants/__tests__/statuses.test.ts`
- **Test Content**:
    ```typescript
    import { ISSUE_STATUSES } from '../statuses';

    describe('ISSUE_STATUSES', () => {
      it('should define canonical status values', () => {
        expect(ISSUE_STATUSES.IN_PROGRESS).toBe('in-progress');
        expect(ISSUE_STATUSES.BACKLOG).toBe('backlog');
        expect(ISSUE_STATUSES.DONE).toBe('done');
      });

      it('should match default board column status mappings', () => {
        const expectedMappings = ['backlog', 'in-progress', 'done'];
        const definedStatuses = Object.values(ISSUE_STATUSES);
        // Verify all defined statuses are present in expected mappings
        expect(definedStatuses).toEqual(expect.arrayContaining(expectedMappings));
      });
    });
    ```

## 3. Definition of Done
- [ ] `src/lib/constants/statuses.ts` exists with canonical values
- [ ] All 9 identified files updated to use constants
- [ ] Database audited and migration created/run if needed
- [ ] New `statuses.test.ts` passes
- [ ] `npm run build` passes
- [ ] `npm run lint` passes
- [ ] No existing issues orphaned by status mismatch

## 4. Implementation Plan
1. Create `src/lib/constants/statuses.ts`
2. Update all 3 production files
3. Update all 6 test files
4. Check database content (sqlite3 `kanban.db` "SELECT...")
5. Handle migration if needed
6. Create and run validation test
7. Run full test suite `npm test`

## 5. Estimated Effort
3-4 hours
