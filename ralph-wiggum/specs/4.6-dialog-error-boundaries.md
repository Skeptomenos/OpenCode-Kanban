# Spec: Phase 4.6 - Dialog Error Boundaries

> **Goal**: Add error boundaries to mutation-heavy dialog components to prevent sidebar crashes.
> **Context**: Board dialogs perform mutations that could throw during render. Without error boundaries, the entire sidebar could crash.
> **Issue Reference**: `docs/phase4-board-management-issues.md#L2`

## 1. Problem Statement

Dialog components in `src/features/boards/components/` have no error boundaries:
- `CreateBoardDialog`
- `DeleteBoardDialog`
- `RenameBoardDialog`
- `BoardActionsMenu` (orchestrates the above)

If any mutation throws unexpectedly during render, React's default behavior would crash the component tree, potentially breaking the entire sidebar.

## 2. Requirements

### 2.1 Create Generic Dialog Error Boundary
- **File**: `OpenKanban/src/components/ui/dialog-error-boundary.tsx` (Create new file)
- **Implementation**:
    ```tsx
    'use client';
    import { Component, ReactNode } from 'react';

    interface Props {
      children: ReactNode;
      fallback?: ReactNode;
    }

    interface State {
      hasError: boolean;
    }

    export class DialogErrorBoundary extends Component<Props, State> {
      state: State = { hasError: false };

      static getDerivedStateFromError(): State {
        return { hasError: true };
      }

      componentDidCatch(error: Error, errorInfo: React.ErrorInfo): void {
        console.error('DialogErrorBoundary caught error:', error, errorInfo);
      }

      render(): ReactNode {
        if (this.state.hasError) {
          return this.props.fallback ?? (
            <div className="text-destructive text-sm p-2">
              Something went wrong
            </div>
          );
        }
        return this.props.children;
      }
    }
    ```

### 2.2 Wrap BoardActionsMenu
- **File**: `OpenKanban/src/components/layout/app-sidebar.tsx`
- **Update**: Wrap `<BoardActionsMenu>` with `<DialogErrorBoundary>`
    ```tsx
    <DialogErrorBoundary>
      <BoardActionsMenu
        boardId={board.id}
        boardName={board.name}
        projectId={projectId}
      />
    </DialogErrorBoundary>
    ```

### 2.3 Optional: Add Reset Capability
- Allow user to retry after error
- Consider adding a "Retry" button in fallback UI

## 3. Definition of Done
- [ ] `dialog-error-boundary.tsx` exists and exports `DialogErrorBoundary`
- [ ] `BoardActionsMenu` is wrapped with error boundary in sidebar
- [ ] Component catches render errors gracefully
- [ ] Fallback UI displays when error occurs
- [ ] `npm run build` passes
- [ ] `npm run lint` passes

## 4. Implementation Plan
1. Create `DialogErrorBoundary` component
2. Export from `src/components/ui/index.ts` (if barrel exists)
3. Update `app-sidebar.tsx` to wrap `BoardActionsMenu`
4. Test by intentionally throwing in a dialog (dev only)
5. Verify sidebar remains functional when dialog errors

## 5. Estimated Effort
1-2 hours
